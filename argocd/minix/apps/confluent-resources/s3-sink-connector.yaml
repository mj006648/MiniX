apiVersion: platform.confluent.io/v1beta1
kind: Connector
metadata:
  name: s3-sink-parking-events
  namespace: confluent
spec:
  # ★★★★★ [핵심 수정 1] 필수 필드 spec.class 추가 ★★★★★
  class: "io.confluent.connect.s3.S3SinkConnector"
  
  # ★★★★★ [핵심 수정 2] spec.maxTasks -> spec.taskMax 로 이름 변경 ★★★★★
  taskMax: 2

  kafkaClusterRef:
    name: kafka
  connectClusterRef:
    name: connect
  
  configs:
    # spec.class로 이동했으므로 여기서는 제거해도 되지만, 하위 호환성을 위해 남겨두어도 무방합니다.
    # "connector.class": "io.confluent.connect.s3.S3SinkConnector" 
    "topics": "parking-entries,parking-exits"
    "format.class": "io.confluent.connect.s3.format.json.JsonFormat"
    "flush.size": "100"
    "storage.class": "io.confluent.connect.s3.storage.S3Storage"
    "s3.bucket.name": "iceberg"
    "store.url": "http://rook-ceph-rgw-my-store.rook-ceph.svc:80"
    "topics.dir": "landing"
    "partitioner.class": "io.confluent.connect.storage.partitioner.TimeBasedPartitioner"
    "path.format": "'year'=YYYY/'month'=MM/'day'=dd"
    "partition.duration.ms": "86400000"
    "locale": "ko_KR"
    "timezone": "Asia/Seoul"
    "timestamp.extractor": "Record"
  secretRef:
    name: s3-credentials
